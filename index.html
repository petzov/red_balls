<!--
Author : Atul Pandit
Email : atul_pandit@yahoo.com / atul.pandit@gmail.com
-->
<!-- 
DEMO LINK
http://bl.ocks.org/atul-github/0019158da5d2f8499f7f
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Bouncing Balls in rectangle using D3js - by Atul</title>
    <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="js/agent.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
    <script src="js/lines.js"></script>
     <!-- <script src="https://d3js.org/d3-drag.v1.min.js"></script> -->
     <style>

    .active {
      stroke: #000;
      stroke-width: 2px;
    }
    .data{
        display: inline-table;
        border: 1px solid #8f8f92;
        text-align: center;
        font-family: sans-serif;
        margin: -1px;
        padding: 0 8px 0 8px;
    }

    </style>
</head>
<body>

<script>

    var numberAgents = 50;
    var MOC = 600; // Minimal optimal cost
    var agents = []; // global array representing balls
    var boxes = [];
    var positions = {};
    var startCost = 100;
    var cutCost = 1;

    positions["benefits"] = 60;
    positions["effort"] = 80;
    positions["price"] = 150;
    positions["quantity"] = 80;


    var t = d3.timer(function () {
       // goals[0].Move(20);
        // for (var i = 0; i < agents.length; ++i) {
        //     var r = balls[i].Move();
        //     for (var j = 0 ; j < paddles.length; ++j) {
        //         ProcessBounce(i, j);
        //     }                                 
        // }
    }
        , 500);

    var moving_goal = d3.interval(function (){
 
    }, 1000);

   // var color = d3.scale.category20();




    function Initialize(containerId) {
        var height = document.getElementById(containerId).clientHeight;
        var width = document.getElementById(containerId).clientWidth;
        gContainerId = containerId;
        gCanvasId = containerId + '_canvas';
        gTopGroupId = containerId + '_topGroup';
        var svg = d3.select("#" + containerId).append("svg")
            .attr("id", gCanvasId)
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("id", gTopGroupId)
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", width)
            .attr("height", height)
            .style("fill", "none")
        //.attr("transform", "translate(" + 1 + "," + 1 + ")")
        ;


        return svg;
    }

    function AddSuff(){

        for (var i = 0; i < numberAgents; ++i) {      
            agents.push(new Agent(svg, randomInt(10,880), randomInt(10,280), 's0', 'red', 50));

            agents[i].Draw();
        }



        hor_line(svg,"benefits", "above");
        hor_line(svg,"effort", "bellow");
        hor_line(svg,"price", "bellow");

        quantity(svg,"quantity");

        DrawMoc();
    }


  
    function randomInt(min,max){
        return Math.floor(Math.random()*(max-min+1)+min);
    }

    function CutCost(){
        startCost = startCost / 2;
        calculate_value();
        DrawMoc();
    }

    function moveMoc(x){
        MOC += x;
        calculate_value();
        DrawMoc();
    }

    var startStopFlag = null;
    function StartStopGame() {
        console.log("StartStop:" + startStopFlag);
        if (startStopFlag == null) {
            
            t.restart(function () {
                var i=0;
            // for (var i = 0; i < balls.length; ++i) {
            //     var r = balls[i].Move();
            //     for (var j = 0 ; j < paddles.length; ++j) {
            //         ProcessBounce(i, j);
            //     }
                                 
            // }
    }
        , 500);
            startStopFlag = 1;
            document.getElementById('startStop').innerHTML = 'Stop';
        }
        else {
            t.stop();
            // moving_goal.stop();
            startStopFlag = null;
            document.getElementById('startStop').innerHTML = 'Start';
        }
    }
    // I always like to handle ESC key
    d3.select('body')
            .on('keydown', function () {
                if (agents.length == 0)
                    return;
                console.log(d3.event);
                if (d3.event.keyCode == 27) { // if ESC key - toggle start stop
                    StartStopGame();
                }
            });



</script>
<div id="mainDiv" style="width:900px; height:300px">
    <div id="drawAreaOuter" style="width:100%; height:100%;  ">
        <div id="menuTop" >
            <a id="startStop" href="javascript:StartStopGame()">Start</a> | 
             <a id="cutCost" href="javascript:CutCost()">Cut Cost</a>| 
             <a id="moveMoc" href="javascript:moveMoc(-100)">&lt;&lt;</a> MOC
             <a id="moveMoc" href="javascript:moveMoc(100)">&gt;&gt;</a>
        </div>
        <div id="drawArea" style="width:100%; height:100%; border:1px solid gray">
        </div>
        <div id="dataArea">
            <div class="data">Value<div id="value"></div></div> 
            <div class="data">Customers [%]<div id="customers"></div></div>
            <div class="data">Cost<div id="cost"></div></div>
            <div class="data">Revenue<div id="revenue"></div></div>
            <div class="data">Profit<div id="profit"></div></div>
        </div>
    </div>
</div>

<script>
    var svg = Initialize('drawArea');
    AddSuff();
    StartStopGame();

</script>

</body>
</html>